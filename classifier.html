---
layout: page
title: "Classifier"
permalink: /classifier
---


<!-- Create a container for the Gradio app if needed -->
<div id="gradio-app"><h2>JavaScript code that accesses Gradio API at HuggingFace spaces</h2>
<button id="test-button">Test</button>
<script>
    function printconsole() {
        console.log('test button clicked')
    }
    tst = document.getElementById("test-button")
    tst.addEventListener("click", printconsole)
</script>
<input id="upload_image" type="file">
<div id="display_image">

</div>
<!-- Add a button to trigger the prediction -->
<button id="predict-button">Predict</button>

<!-- Include your JavaScript code -->
<script type="module">
    console.log('in second script')
    import {client} from "https://cdn.jsdelivr.net/npm/@gradio/client@0.1.4/dist/index.min.js";
        console.log('gradio imported')
        // Function to trigger the prediction and update the result on the webpage
        async function predictWithGradio() {
            console.log('Button clicked')
            // Get the image data URL from the src attribute
            const imageDataURL = document.getElementById("CommonChickweed").src;
            console.log('got image data URL')
            // Convert the data URL to a Blob
            console.log(imageDataURL)
            const response_0 = await fetch(imageDataURL);
            console.log(response_0)
            const exampleImage = await response_0.blob();
            // const exampleImage = dataURLToBlob(imageDataURL);
            console.log('got image')
            console.log(typeof exampleImage)

            const app = await client("https://dhits-weed-classifier.hf.space/");
            console.log("app is ready")
            const result = await app.predict("/predict", [exampleImage]);
            console.log(result.data);
            // Update the result on the webpage
            document.getElementById("prediction-result").innerText = 'Test';
            document.getElementById("prediction-result").innerText = JSON.stringify(result.data, null, 2);
        }

         // Function to convert a data URL to a Blob
         function dataURLToBlob(dataURL) {
        
            const arr = dataURL.split(",");
            console.log(arr.length)
            console.log(arr[0])

            const mime = arr[0].match(/:(.*?);/)[1];
            const byteString = atob(arr[1]);
            console.log(arr[1])
        
            let n = byteString.length;
            const uint8Array = new Uint8Array(n);
            for (let i = 0; i < byteString.length; i++) {
                uint8Array[i] = byteString.charCodeAt(i);
            }
            return new Blob([uint8Array], { type: mime });
        }

        // Add event listener to the button
        document.getElementById("predict-button").addEventListener("click", predictWithGradio);

</script>
</div>
<!-- Add a container to display the prediction result -->
<div id="prediction-result">Prediction</div>
<div>Examples:
    <img id="CommonChickweed" src="media/CommonChickweed.png" alt="Common Chickweed" width="300" height="150">
    <img src="media/FatHen.png" alt="Fat Hen" width="300" height="150">
    <img src="media/SugarBeet.png" alt="SugarBeet" width="300" height="150">
</div>

<div>This model was trained on the dataset that contains 5,539 images of crop and weed seedlings. 
    The images are grouped into 12 classes. 
    These classes represent common plant species in Danish agriculture at different growth stages.
        A pretrained ResNet34  model was fine-tuned using fastai vision library. The error rate achived on the validation dataset is 2.5% after 4 epochs.
    Currently the model does not generalize well on the out-of-domain images. Probably because of the specificity of the dataset. 
    The images in the dataset are of a single plant taken from the top and on a single background of a grit surface. Some images have barcode labels that might be unique to the particular plant. 
    The last two images in the examples are not from the dataset. They are getting wrongly classified as <b>Scentless Mayweed</b> even though they are <b>Small-flowered Cranesbill</b> (compare with the second image in the examples)
    <p style='text-align: center'><a href='https://tmabraham.github.io/blog/gradio_hf_spaces_tutorial' target='_blank'>Blog post</a></p>
</div>